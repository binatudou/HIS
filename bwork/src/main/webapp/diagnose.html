<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="lib/jquery-easyui-1.7.0/themes/default/easyui.css">
  <link rel="stylesheet" type="text/css" href="lib/jquery-easyui-1.7.0/themes/icon.css">
  <script type="text/javascript" src="lib/jquery-easyui-1.7.0/jquery.min.js"></script>
  <script type="text/javascript" src="lib/jquery-easyui-1.7.0/jquery.easyui.min.js"></script>
</head>

<body onload="load();">
  <div style="width:100%; height: 200px; padding: 20px;">

    <div>
      <label>病种搜索：</label>
      <input class="easyui-textbox" name="dise-search" id="dise-search" prompt="请输入病种" style="width:200px">
    </div>

    <div>
      <ul class="easyui-datalist" name="dise-list" id="dise-list" lines="true" style="width:100%;height:150px">
        <li value="1">古典型霍乱</li>
        <li value="2">中型[典型]霍乱</li>
        <li value="3">重型[暴发型或干性]霍乱</li>
      </ul>
    </div>

  </div>

  <form id="diagnose-form" method="post">
    <input type="hidden" name="disease" id="input-disease" class="form-control">

    <div style="width: 100%; padding: 20px;">
      <input class="easyui-textbox" name="diagnose" id="diagnose" prompt="在此输入诊断" multiline="true" style="width:100%;height:300px;">
    </div>
  </form>
  <div style="text-align:center;padding:5px">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="diagnosed()">完诊</a>
  </div>

  <script>
    var diseases_info;

    function load() {
      load_disease();
    }

    //从服务器获取疾病信息
    function load_disease() {
      //TODO
      diseases_info = [{
        "id": "1",
        "DiseaseCode": "GDXHL",
        "DiseaseName": "古典型霍乱"
      }, {
        "id": "2",
        "DiseaseCode": "ZXDXHL",
        "DiseaseName": "中型[典型]霍乱"
      }, {
        "id": "3",
        "DiseaseCode": "ZXBFXHGXHL",
        "DiseaseName": "重型[暴发型或干性]霍乱"
      }];
    }

    //提交诊断信息，并清空界面
    function diagnosed() {
      $("diagnose-form").form("submit");
      alert("提交成功");
      $("#diagnose").textbox("setValue", "");
      $("#dise-search").textbox("setValue", "");
      search_disease();
    }

    //键入时根据疾病助记码查找并填入
    function search_disease() {
      var keyword = $("input", $("#dise-search").next("span")).val();
      var reg = new RegExp(keyword);
      var dise_arr = new Array();
      var dise_list = $("#dise-list");

      diseases_info.forEach(disease => {
        if (reg.test(disease.DiseaseCode)) {
          dise_arr.push({
            "value": disease.id,
            "text": disease.DiseaseName
          });
        }
      });

      dise_list.datagrid({
        data: dise_arr
      });
    }

    //选中疾病后将疾病id输入表单
    function set_disease() {
      var input_disease = $("#input-disease");
      var dise_list = $("#dise-list");
      input_disease.val(dise_list.getSelectedValue());
    }

    //绑定输入框
    $(function() {
      $("input", $("#dise-search").next("span")).keyup(function() {
        search_disease();
      });
    });
  </script>
</body>

</html>