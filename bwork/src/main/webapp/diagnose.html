<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" type="text/css" href="lib/jquery-easyui-1.7.0/themes/default/easyui.css">
  <link rel="stylesheet" type="text/css" href="lib/jquery-easyui-1.7.0/themes/icon.css">
  <script type="text/javascript" src="lib/jquery-easyui-1.7.0/jquery.min.js"></script>
  <script type="text/javascript" src="lib/jquery-easyui-1.7.0/jquery.easyui.min.js"></script>
</head>

<body onload="load();">
  <div style="width:100%; height: 200px; padding: 20px;">
    <div>
      <label>病种搜索：</label>
      <input id="diseSearch" class="easyui-textbox" prompt="请输入病种助记码" style="width:200px">
    </div>
    <div id="diseList" style="width:100%;height:150px"></div>
  </div>

  <div style="width: 100%; padding: 20px;">
    <input class="easyui-textbox" name="diagnose" id="diagnose" prompt="在此输入诊断" multiline="true" style="width:100%;height:300px;">
  </div>

  <div style="text-align:center;padding:5px">
    <a href="javascript:void(0)" class="easyui-linkbutton" onclick="diagnosed()">完诊</a>
  </div>

  <script>
    var diseases_info;
    var selectedDiseID;
    var diseList = $('#diseList');
    var diseSearch = $("#diseSearch");

    function load() {
      //疾病列表
      diseList.datalist({
        url: "diseFindAll",
        method: "post",
        striped: "true",
        valueField: 'diseaseID',
        textField: 'diseName',
        singleSelect: true,
        onSelect: function(index, rowData) {
          selectedDiseID = rowData.diseaseID;
        }
      });
      //疾病备份
      diseases_info = diseList.datalist("getData");
      //test
      alert(diseases_info);
      //test
      //疾病查询框
      diseSearch.textbox({
        onChange: function(n, o) {

        }
      });
    }

    //提交诊断信息，并清空界面
    function diagnosed() {
      $("diagnose-form").form("submit");
      alert("提交成功");
      $("#diagnose").textbox("setValue", "");
      $("#diseSearch").textbox("setValue", "");
      search_disease();
    }

    //键入时根据疾病助记码查找并填入
    function search_disease() {
      var keyword = $("input", $("#diseSearch").next("span")).val();
      var reg = new RegExp(keyword);
      var dise_arr = new Array();
      var dise_list = $("#dise-list");

      diseases_info.forEach(disease => {
        if (reg.test(disease.DiseaseCode)) {
          dise_arr.push({
            "value": disease.id,
            "text": disease.DiseaseName
          });
        }
      });

      dise_list.datagrid({
        data: dise_arr
      });
    }

    //绑定输入框
    $(function() {
      $("input", $("#diseSearch").next("span")).keyup(function() {
        search_disease();
      });
    });
  </script>
</body>

</html>